@model List<Task4.Models.User>

@{
    ViewData["Title"] = "User Management";
}

<div class="container-fluid py-4">
    <div class="card">
        <div class="card-header bg-purple text-white">
            <div class="d-flex justify-content-between align-items-center">
                <h3 class="mb-0"><i class="fas fa-users-cog me-2"></i>@ViewData["Title"]</h3>
                <div class="d-flex gap-2">
                    <button id="blockBtn" class="btn btn-danger btn-icon" title="Block users">
                        <i class="bi bi-lock-fill"></i>
                    </button>
                    <button id="unblockBtn" class="btn btn-success btn-icon" title="Unblock users">
                        <i class="bi bi-unlock-fill"></i>
                    </button>
                    <button id="deleteBtn" class="btn btn-warning btn-icon" title="Delete users">
                        <i class="bi bi-trash-fill"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th width="50px">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="selectAll">
                                </div>
                            </th>
                            <th><i class="fas fa-user me-1"></i> Name</th>
                            <th><i class="fas fa-envelope me-1"></i> Email</th>
                            <th><i class="fas fa-sign-in-alt me-1"></i> Last Login</th>
                            <th><i class="fas fa-calendar-plus me-1"></i> Registration Date</th>
                            <th><i class="fas fa-circle me-1"></i> Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model)
                        {
                            <tr class="@(user.IsBlocked ? "table-danger" : "")">
                                <td>
                                    <div class="form-check">
                                        <input class="form-check-input user-checkbox" type="checkbox" value="@user.Id">
                                    </div>
                                </td>
                                <td>@user.UserName</td>
                                <td><a href="mailto:@user.Email">@user.Email</a></td>
                                <td>@(user.LastLogin?.ToString("g") ?? "Never")</td>
                                <td>@user.RegistrationDate.ToString("g")</td>
                                <td>
                                    <span class="badge @(user.IsBlocked ? "bg-danger" : "bg-success")">
                                        @(user.IsBlocked ? "Blocked" : "Active")
                                    </span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>

        $(document).ready(function() {
            
            // Select all checkboxes
            $('#selectAll').change(function() {
                $('.user-checkbox').prop('checked', this.checked);
            });
            
            // Block selected users
            $('#blockBtn').click(function() {
                var selectedIds = $('.user-checkbox:checked').map(function() {
                    return $(this).val();
                }).get();
                
                if (selectedIds.length > 0) {
                    $.post('@Url.Action("Block", "Users")', { userIds: selectedIds }, function() {
                        location.reload();
                    });
                }
            });
            
            // Unblock selected users
            $('#unblockBtn').click(function() {
                var selectedIds = $('.user-checkbox:checked').map(function() {
                    return $(this).val();
                }).get();
                
                if (selectedIds.length > 0) {
                    $.post('@Url.Action("Unblock", "Users")', { userIds: selectedIds }, function() {
                        location.reload();
                    });
                }
            });

           // Delete selected users
            $('#deleteBtn').click(function() {
                var selectedIds = $('.user-checkbox:checked').map(function() {
                    return $(this).val();
                }).get();
                
                if (selectedIds.length > 0) {
                    if (confirm('Are you sure you want to delete the selected users?')) {
                        $.post('@Url.Action("Delete", "Users")', { userIds: selectedIds }, function() {
                            location.reload();
                        });
                    }
                }
            });
        });
    </script>
}